<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.17.0/full/pyodide.js"></script>
</head>

<body>
    <h1>Your first Python 3 program</h1>
  <p>By convention, the first program a programmer writes when learning a new programming language outputs the words "Hello world" to the screen.</p>
  
  <p>To do this in Python, type the following into the text field below:</p>
  <p><code>print('hello world')</code></p>
  
    <textarea style="width: 100%;font-family: Monaco" id='code' rows='6' ></textarea>
  <button onclick='evaluatePython()'>Run</button>
  <br>
  <br>
  <div>
    Output:
  </div>
  <textarea id='output' style='width: 100%;font-family: Monaco;' rows='20' disabled></textarea>

  <script>
    const output = document.getElementById("output");
    const code = document.getElementById("code");

    function addToOutput(s) {
      output.value += '>>>' + code.value + '\n' + s + '\n';
    }

    output.value = 'Initializing...\n';
    // init Pyodide
    async function main(){
      await loadPyodide({ indexURL : 'https://cdn.jsdelivr.net/pyodide/v0.17.0/full/' });
          pyodide.runPython(`
            import sys
            from os import system
            sys.version
            import io
            sys.stdout = io.StringIO()
        `);
      output.value += 'Ready!\n';
    }

    let pyodideReadyPromise = main();

    async function evaluatePython() {
      await pyodideReadyPromise;
      try {
        let output = await pyodide.runPythonAsync(code.value);
        
        var stdout = pyodide.runPython("sys.stdout.getvalue()")
        pyodide.runPython("sys.stdout = io.StringIO()")
        addToOutput(stdout);
        
      } catch(err) {
        addToOutput(err);
      }
    }
  </script>
</body>

</html>